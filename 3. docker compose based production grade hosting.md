# üöÄ Production-Ready Deployment of Go-Todo on Linux VM (Vagrant + Docker Compose)

This documentation provides a **step-by-step guide** to deploying the **Go-Todo Application** on a Linux-based Virtual Machine using **Vagrant, Docker, and Docker Compose**.

The setup ensures:

* **Isolated containers** for backend, frontend, database, and reverse proxy
* **Bridged network** for LAN access
* **Persistent MongoDB storage**
* **Production-ready Nginx reverse proxy**

---

## 1Ô∏è‚É£ VM Provisioning with Vagrant

Create a `Vagrantfile` in your project root:

```ruby
Vagrant.configure("2") do |config|
  # Base Image
  config.vm.box = "generic/ubuntu2204"

  # VM Name
  config.vm.define "go-todo-vm"

  # VM Provider Settings (Libvirt)
  config.vm.provider :libvirt do |libvirt|
    libvirt.name = "go-todo-vm"
    libvirt.memory = 4096          # 4GB RAM
    libvirt.cpus = 2               # 2 CPU cores
  end

  # Bridged Network (LAN access)
  config.vm.network "public_network", dev: "wlp0s20f3"
end
```

---

## 2Ô∏è‚É£ Launch VM & SSH

```bash
vagrant up
vagrant ssh
```

Check assigned IP:

```bash
ip a
```

**VM IP**: `192.168.121.220/24`

---

## 3Ô∏è‚É£ Install Docker & Docker Compose

Inside the VM:

```bash
sudo apt update && sudo apt upgrade -y

# Install Docker
sudo apt install -y docker.io
sudo systemctl enable docker
sudo systemctl start docker

# Install Docker Compose v2
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
docker-compose --version
```

---

## 4Ô∏è‚É£ Clone the Project Repository

```bash
cd ~
git clone https://github.com/SAYEM-16T/go-todo-v1.git
cd go-todo-v1
```

Project structure:

```
go-todo-v1/
‚îú‚îÄ‚îÄ auth-service/         # Backend (Go)
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ main.go
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ frontend/             # Frontend (React + Vite)
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile.prod
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ nginx/                # Root Reverse Proxy
‚îÇ   ‚îî‚îÄ‚îÄ default.conf
‚îú‚îÄ‚îÄ mongo-data/           # MongoDB persistent volume
‚îú‚îÄ‚îÄ docker-compose.yml    # Main orchestration file
```

---

## 5Ô∏è‚É£ Docker Compose Configuration

Create `docker-compose.yml` in project root:

```yaml
version: "3.9"

services:
  backend:
    build:
      context: ./auth-service
      dockerfile: Dockerfile
    container_name: backend
    environment:
      - MONGO_URL=mongodb://mongodb:27017/todo
      - JWT_SECRET=supersecret
    ports:
      - "10000:10000"
    networks:
      - app-network
    depends_on:
      - mongodb

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod
    container_name: frontend
    networks:
      - app-network

  nginx:
    image: nginx:alpine
    container_name: nginx
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "8080:80"
    depends_on:
      - backend
      - frontend
    networks:
      - app-network

  mongodb:
    image: mongo:7
    container_name: mongodb
    volumes:
      - ./mongo-data:/data/db
    ports:
      - "27017:27017"
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
```

---

## 6Ô∏è‚É£ Nginx Reverse Proxy Configuration

Create `nginx/default.conf`:

```nginx
server {
    listen 80;

    server_name _;

    # Proxy API requests ‚Üí backend
    location /api/ {
        proxy_pass http://backend:10000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Serve frontend (static build)
    location / {
        proxy_pass http://frontend:80;
    }
}
```

---

## 7Ô∏è‚É£ Run the Application

```bash
cd ~/go-todo-v1

# Stop and clean old containers
docker-compose down -v

# Build and run in detached mode
docker-compose up -d --build
```

---

## 8Ô∏è‚É£ Verify Deployment

Check running containers:

```bash
docker ps
```

You should see:

```
nginx, frontend, backend, mongodb
```

Open in browser (host machine, not VM):

```
http://192.168.121.220:8080
```

üéØ Use this IP for your screenshots.

---

## 9Ô∏è‚É£ Notes for Production Hardening

* ‚úÖ Use **env files** (`.env`) for secrets instead of hardcoding
* ‚úÖ Configure **firewall (ufw)** to only allow necessary ports
* ‚úÖ Setup **HTTPS** with Nginx + Certbot if deploying outside LAN
* ‚úÖ Use **Docker volumes** for MongoDB data persistence (already included)
* ‚úÖ Monitor containers with `docker logs` and `docker stats`

---

## ‚úÖ Final Architecture

```
Host Browser
    ‚îÇ
    ‚ñº
[ Nginx Reverse Proxy (8080) ]
    ‚îÇ
 ‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 ‚îÇ         ‚îÇ         ‚îÇ
 ‚ñº         ‚ñº         ‚ñº
Frontend   Backend   MongoDB
(React)    (Go)      (Database)
```

---

üìå With this setup, your **Go-Todo Application** is fully production-ready inside a Linux VM.
LAN users can access it via `http://192.168.121.220:8080`.

---
---

vagrant@ubuntu2204:~/go-todo-v1$ docker logs -f nginx
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: can not modify /etc/nginx/conf.d/default.conf (read-only file system?)
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2025/10/02 17:17:08 [notice] 1#1: using the "epoll" event method
2025/10/02 17:17:08 [notice] 1#1: nginx/1.29.1
2025/10/02 17:17:08 [notice] 1#1: built by gcc 14.2.0 (Alpine 14.2.0) 
2025/10/02 17:17:08 [notice] 1#1: OS: Linux 5.15.0-91-generic
2025/10/02 17:17:08 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/02 17:17:08 [notice] 1#1: start worker processes
2025/10/02 17:17:08 [notice] 1#1: start worker process 21
2025/10/02 17:17:08 [notice] 1#1: start worker process 22
192.168.121.1 - - [02/Oct/2025:17:17:56 +0000] "GET / HTTP/1.1" 200 316 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
2025/10/02 17:17:56 [warn] 22#22: *1 an upstream response is buffered to a temporary file /var/cache/nginx/proxy_temp/1/00/0000000001 while reading upstream, client: 192.168.121.1, server: _, request: "GET /assets/index-XKjbZBS0.js HTTP/1.1", upstream: "http://172.18.0.3:80/assets/index-XKjbZBS0.js", host: "192.168.121.220:8080", referrer: "http://192.168.121.220:8080/"
192.168.121.1 - - [02/Oct/2025:17:17:56 +0000] "GET /assets/index-XKjbZBS0.js HTTP/1.1" 200 180630 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:17:17:56 +0000] "GET /favicon.ico HTTP/1.1" 200 316 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:17:47:38 +0000] "GET / HTTP/1.1" 304 0 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:17:47:38 +0000] "GET /assets/index-XKjbZBS0.js HTTP/1.1" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:17:47:38 +0000] "GET /favicon.ico HTTP/1.1" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:17:49:00 +0000] "GET / HTTP/1.1" 304 0 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:17:50:49 +0000] "GET / HTTP/1.1" 304 0 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:19:48:09 +0000] "GET /favicon.ico HTTP/1.1" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:19:48:13 +0000] "GET / HTTP/1.1" 200 316 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
192.168.121.1 - - [02/Oct/2025:19:48:13 +0000] "GET /assets/index-XKjbZBS0.js HTTP/1.1" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"

---
---

vagrant@ubuntu2204:~$ docker logs -f frontend
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: /etc/nginx/conf.d/default.conf differs from the packaged version
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2025/10/02 17:17:07 [notice] 1#1: using the "epoll" event method
2025/10/02 17:17:07 [notice] 1#1: nginx/1.29.1
2025/10/02 17:17:07 [notice] 1#1: built by gcc 14.2.0 (Alpine 14.2.0) 
2025/10/02 17:17:07 [notice] 1#1: OS: Linux 5.15.0-91-generic
2025/10/02 17:17:07 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/02 17:17:07 [notice] 1#1: start worker processes
2025/10/02 17:17:07 [notice] 1#1: start worker process 28
2025/10/02 17:17:07 [notice] 1#1: start worker process 29
172.18.0.5 - - [02/Oct/2025:17:17:56 +0000] "GET / HTTP/1.0" 200 316 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:17:17:56 +0000] "GET /assets/index-XKjbZBS0.js HTTP/1.0" 200 180630 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:17:17:56 +0000] "GET /favicon.ico HTTP/1.0" 200 316 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:17:47:38 +0000] "GET / HTTP/1.0" 304 0 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:17:47:38 +0000] "GET /assets/index-XKjbZBS0.js HTTP/1.0" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:17:47:38 +0000] "GET /favicon.ico HTTP/1.0" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:17:49:00 +0000] "GET / HTTP/1.0" 304 0 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:17:50:49 +0000] "GET / HTTP/1.0" 304 0 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:19:48:09 +0000] "GET /favicon.ico HTTP/1.0" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:19:48:13 +0000] "GET / HTTP/1.0" 200 316 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"
172.18.0.5 - - [02/Oct/2025:19:48:13 +0000] "GET /assets/index-XKjbZBS0.js HTTP/1.0" 304 0 "http://192.168.121.220:8080/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" "-"






